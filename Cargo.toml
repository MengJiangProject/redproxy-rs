[package]
name = "redproxy-rs"
version = "0.5.3"
authors = ["Bearice Ren <bearice@icybear.net>"]
edition = "2018"
default-run = "redproxy-rs"

[[bin]]
name = "redproxy-rs"
path = "src/main.rs"

[features]
default = ["quic","metrics","embedded-ui"]
quic = ["quinn","futures-util","pin-project-lite"]
metrics = ["axum","tower","tower-http","prometheus","lazy_static"]
embedded-ui = ["metrics"]

[dependencies]
milu = { path = "milu" }
tokio = { version = "1.11.0", features = ["full"] }
tokio-rustls = { version="0.22.0", features = ["dangerous_configuration"] }
async-trait = "0.1.51"
easy-error = "1.0.0"
log = "0.4"
env_logger = "0.9.0"
yaml-rust = "0.4"
serde = { version = "1.0", features = ["derive","rc"] }
serde_yaml = "0.8.21"
serde_json = "1.0"
clap = "2.33"
futures = "0.3.17"
cidr = "0.2.0"
rand = "0.8.4"
libc = "0.2"
mio = "0.7.13"

# features quic
quinn = { version = "0.7.2", optional = true}
futures-util = { version = "0.3.17", optional = true}
pin-project-lite = { version = "0.2.6", optional = true }

# features metrics
axum = { version = "0.2.5", optional = true }
tower = { version = "0.4", optional = true }
tower-http = { version = "0.1", optional = true, features = ["add-extension","fs","set-header"] }
prometheus = {version = "0.13.0", optional = true, features = ["process"] }
lazy_static = { version = "1", optional = true }

[target.'cfg(any(target_os = "android", target_os = "linux"))'.dependencies]
nix = { version = "0.23.0"}

[dev-dependencies]
tokio-test = "0.4.2"
test-env-log = "0.2.7"

[build-dependencies]
mime_guess = "2.0.3"

[workspace]
members = ["milu"]