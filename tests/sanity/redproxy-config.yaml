listeners:
  - name: http
    type: http
    bind: "0.0.0.0:8800"
  - name: socks
    type: socks
    bind: "0.0.0.0:1081"

connectors:
  - name: direct
    type: direct
  - name: upstream-http
    type: http
    server: "http-proxy"
    port: 3128
  - name: upstream-socks
    type: socks
    server: "socks-proxy"
    port: 1080

rules:
  # Direct connection to echo server (test direct connector)
  - filter: 'request.target.host == "http-echo"'
    target: direct
  # Route target-server through upstream HTTP proxy (test HTTP connector)  
  - filter: 'request.target.host == "target-server" && request.listener == "http"'
    target: upstream-http
  # Route target-server through upstream SOCKS proxy (test SOCKS connector)
  - filter: 'request.target.host == "target-server" && request.listener == "socks"'
    target: upstream-socks
  # Default fallback to direct
  - filter: "true"
    target: direct

accessLog:
  path: /tmp/access.log
  format: json