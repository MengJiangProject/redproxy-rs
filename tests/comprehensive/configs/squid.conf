# Squid HTTP proxy configuration for RedProxy testing

# Network and port configuration
http_port 3128

# Allow access from test network
acl localnet src 172.20.0.0/16
acl localhost src 127.0.0.1/32

# Safe ports and connect methods
acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp  
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http

acl CONNECT method CONNECT

# Access rules
http_access allow localnet
http_access allow localhost
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

# Allow CONNECT to any port for testing
http_access allow CONNECT all
http_access allow all

# Basic settings
coredump_dir /var/spool/squid

# Logging
access_log stdio:/dev/stdout squid
cache_log /dev/stderr

# Memory and cache settings
cache_mem 64 MB
maximum_object_size_in_memory 32 KB
memory_replacement_policy lru

# No disk cache for testing
cache_dir null /tmp

# DNS will use system resolver

# Don't cache anything for testing
cache deny all

# Headers
request_header_add X-Forwarded-By "squid-upstream-proxy" all
reply_header_add X-Served-By "squid-upstream-proxy" all

# Shutdown settings
shutdown_lifetime 2 seconds