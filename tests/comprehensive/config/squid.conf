# Squid configuration for test environment
# Allow CONNECT method for all ports (needed for HTTP CONNECT proxy testing)
#
# WARNING: This configuration is INSECURE and should NEVER be used in production!
# The "allow all" ACL permits unrestricted access from any source.
# In production, use specific source IP ranges and restricted port lists.

# Basic configuration - dual port setup
# Port 3128: No authentication required (for backward compatibility)
# Port 3129: Authentication required (for auth testing)
http_port 3128
http_port 3129

# Authentication configuration (only for port 3129)
auth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/passwd
auth_param basic children 5
auth_param basic realm Squid proxy-caching web server with authentication
auth_param basic credentialsttl 2 hours
auth_param basic casesensitive off

# Access control
acl authenticated proxy_auth REQUIRED
acl all src all
acl auth_port localport 3129
acl no_auth_port localport 3128

# Port-based access control
# Port 3128: Allow all (no auth required)
http_access allow no_auth_port
# Port 3129: Require authentication
http_access allow auth_port authenticated
# Deny others (will return 407 for port 3129 without auth)
http_access deny all

# Allow CONNECT to all ports (needed for proxy testing)
# PRODUCTION WARNING: This allows CONNECT to ALL ports (1-65535)
# In production, restrict to specific ports: acl SSL_ports port 443 563 873 8443
acl SSL_ports port 1-65535
acl CONNECT method CONNECT
http_access allow CONNECT SSL_ports

# Cache configuration (minimal for testing)
cache_dir ufs /var/spool/squid 100 16 256
cache_mem 64 MB

# Logging
access_log /var/log/squid/access.log squid

# Don't cache anything (for testing)
cache deny all